#
# GNU General Public License v3.0
#   
# Copyright (C) 2021 GhostActive
#
# Author
#    GhostActive, https://github.com/ghostactive
#
# Version
#    1.0
#

function flush-history -d "Clear fish history and prefill with commands"

    # Print help text
    if contains -- "-h" $argv; or contains -- "--help" $argv
        echo ""
        echo "flush-history - Delete and prefill fish history"
        echo ""
        echo "    Usage: flush-history [FILE]..."
        echo ""
        echo "DESCRIPTION"
        echo "    Deletes the fish history and prefill it with given files."
        echo "    Files for prefilling must have a valid fish history format."
        echo ""
        echo "ARGUMENTS"
        echo "    -h, --help       Prints this help text"
        echo ""
        echo "EXAMLPES"
        echo "    # Clean fish history"
        echo "    flush-history"
        echo ""
        echo "    # Clean and prefill fish history"
        echo "    flush-history commands1.txt commands2.txt"
        return 0
    end

    set LENGTH (count $argv)

    set HISTORY_FILE ~/.local/share/fish/fish_history

    # No parameter - just clean fish history
    if test $LENGTH -eq 0
        builtin history clear
        return 0
    end

    # Check whether all given input files exists
    for ITEM in $argv
        if test ! -e $ITEM
            echo "An error occurred: Unknown file '$ITEM'"
            return 1
        end
    end

    # Clear history
    builtin history clear
    
    # Write given files to fish history 
    mkdir -p (dirname $HISTORY_FILE)
    cat $argv > $HISTORY_FILE

    return 0
end
