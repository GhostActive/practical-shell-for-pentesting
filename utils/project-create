#!/bin/bash
#
# NAME
#       project-create - Creates a new project folder containing base files and
#                        subfolders.
#
# SYNOPSIS
#       project-create STRING...
#               
# DESCRIPTION
#       Creates a new project folder based on given arguments. 
#
#       Working correctly, the script expects the following defined
#       (global) environment variables:
#           PROJECTS_PATH ....... Folder to store projects
#           CURRENT ............. Current project path
#           OUTPUT .............. Output folder for tools in CURRENT
#       
#       For more information, please see 
#           https://github.com/GhostActive/effective-shell-for-pentesting/tree/main/utils
#       
# EXAMPLE
#       # Creates a new folder named '2021-05-03-SampleCustomer-SampleProject'
#       project-create SampleCustomer SampleProject
#
# HINT
#       Note that at runtime the symbolic link "$PROJECTS_PATH/current/" is set
#       to new project folder.
#     
# AUTHOR
#       GhostActive, https://github.com/GhostActive/
#
# COPYRIGHT
#       2021, GNU General Public License v3.0
#
# VERSION
#       1.0
#
# SEE ALSO
#       Github: Effective Shell For Pentesting
#           https://github.com/GhostActive/EffectiveShellForPentesting

#
# Suffix for new project folder
#
SUFFIX=$(date +"%F")-

#
# Check if all required environment variables are defined
#
if [[ -z ${PROJECTS_PATH} ]] ||
    [[ -z ${CURRENT} ]] ||
    [[ -z ${OUTPUT} ]]
then
    echo "At least one required environment variable is not defined."
    exit 1
fi

#
# Concatenate root path and read user arguments  
#
PROJECT="$PROJECTS_PATH/$SUFFIX$(echo $@ | tr -s ' ,;#!%&/:.' '-')"

#
# Create new project folder
#
mkdir -p $PROJECT

#
# Create or update symbolic link CURRENT referencing new project folder
#
if [[ -L $CURRENT ]]
then
    ln -sfn $PROJECT $CURRENT
else
    ln -s $PROJECT $CURRENT
fi

#
# Create basic files and subfolders used within pentests
#
mkdir -p $CURRENT/findings/{images,pocs}

mkdir -p $OUTPUT/{nmap,sslscan,testssl,sslyze,nikto,curl}

touch $CURRENT/{hosts,ip4}
